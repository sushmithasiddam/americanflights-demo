<?xml version="1.0" encoding="UTF-8"?>

<mule xmlns:http="http://www.mulesoft.org/schema/mule/http"
	xmlns:ee="http://www.mulesoft.org/schema/mule/ee/core"
	xmlns="http://www.mulesoft.org/schema/mule/core" xmlns:doc="http://www.mulesoft.org/schema/mule/documentation"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xsi:schemaLocation="
http://www.mulesoft.org/schema/mule/http http://www.mulesoft.org/schema/mule/http/current/mule-http.xsd 
http://www.mulesoft.org/schema/mule/ee/core http://www.mulesoft.org/schema/mule/ee/core/current/mule-ee.xsd http://www.mulesoft.org/schema/mule/core http://www.mulesoft.org/schema/mule/core/current/mule.xsd">
	<http:listener-config name="httpListenerConfig" doc:name="HTTP Listener config" doc:id="aeb92c06-4c13-4f85-98c0-cb1d29bb4c49" >
		<http:listener-connection host="${http.host}" port="${http.port}" />
	</http:listener-config>
	<configuration-properties doc:name="Configuration properties" doc:id="4bf69bf9-4bf2-40e1-a4f1-0a97e74a29ca" file="config.yaml" />
	<http:request-config name="httpRequestConfiguration" doc:name="HTTP Request configuration" doc:id="d5234dde-7639-403a-8562-cd1e0e9782c5" basePath="/api" >
		<http:request-connection host="training4-american-ws.cloudhub.io" />
	</http:request-config>	
	<flow name="americanFlights-demoFlow" doc:id="94abcea5-3914-48f1-b4d1-037c05e1b49d" >
		<http:listener doc:name="Listener" doc:id="1dff7382-aecc-49cc-9d71-d5e89a959617" config-ref="httpListenerConfig" path="/demo"/>
		<http:request method="GET" doc:name="Request" doc:id="f1349ee1-5763-4521-8a14-f97079413c6c" config-ref="httpRequestConfiguration" path="/flights"/>
		<ee:transform doc:name="Transform Message" doc:id="d3258c28-a1dc-4b9b-a122-dec6656ac122" >
			<ee:message >
				<ee:set-payload ><![CDATA[%dw 2.0
output application/json
---
payload]]></ee:set-payload>
			</ee:message>
		</ee:transform>
		<error-handler >
			<on-error-propagate enableNotifications="true" logException="true" doc:name="On Error Propagate" doc:id="e62db4f9-0642-47e1-a655-e002ce9deefe" type="HTTP:CONNECTIVITY">
				<set-payload value="Unable to connect to Flights." doc:name="Set Payload" doc:id="871c1f68-5d53-4601-ac4a-80b573843f3b" />
			</on-error-propagate>
		</error-handler>
	</flow>	
</mule>
